{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Legal document attributes",
  "description": "Legal document attributes. Schema draft 4 is used for compatibility with Mongo DB",
  "definitions": {
    "tag": {
      "description": "a piece of text, denoting an attribute",
      "type": "object",
      "properties": {
        "span": {
          "type": "array",
          "minItems": 2,
          "maxItems": 2
        },
        "confidence": {
          "type": "number"
        },
        "span_map": {
          "type": "string"
        }
      },
      "required": ["span"]
    },
    "string_tag": {
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "properties": {
            "value": {
              "type": "string"
            }
          },
          "required": ["span", "value"]
        }
      ]
    },
    "boolean_tag": {
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "properties": {
            "value": {
              "type": "boolean"
            }
          },
          "required": ["span", "value"]
        }
      ]
    },
    "numeric_tag": {
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "properties": {
            "value": {
              "type": "number"
            }
          },
          "required": ["span", "value"]
        }
      ]
    },
    "insideInformation": {
      "description": "Инсайдерская информация",
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "properties": {
            "value": {
              "enum": [
                "Bankruptcy",
                "SharesOfParticipation",
                "SEB",
                "Changes",
                "Licenses",
                "OSA",
                "Accounting",
                "Plans",
                "SD",
                "Deals",
                "Courts",
                "IssuedSecurities"
              ]
            }
          }
        }
      ]
    },
    "date_tag": {
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "properties": {
            "value": {
              "type": "string",
              "format": "date-time"
            }
          },
          "required": ["span", "value"]
        }
      ]
    },
    "agenda_contract": {
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "description": "Атрибуты контракта, о котором идет речь в повестке",
          "properties": {
            "number": {
              "$ref": "#/definitions/string_tag"
            },
            "date": {
              "$ref": "#/definitions/date_tag"
            },
            "orgs": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/org"
              }
            },
            "price": {
              "$ref": "#/definitions/currency_value"
            }
          }
        }
      ]
    },
    "agenda": {
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "properties": {
            "contracts": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/agenda_contract"
              }
            },
            "solution": {
              "description": "Решение, принятое относительно вопроса повестки дня",
              "$ref": "#/definitions/boolean_tag"
            }
          },
          "required": ["span"]
        }
      ]
    },
    "currency": {
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "properties": {
            "value": {
              "enum": [
                "RUB",
                "USD",
                "EURO",
                "KZT",
                "BYN",
                "TJR",
                "RSD",
                "KGS",
                "UAH",
                "Percent"
              ]
            }
          }
        }
      ]
    },
    "sign": {
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "properties": {
            "value": {
              "type": "integer",
              "enum": [-1, 0, 1]
            }
          }
        }
      ]
    },
    "person": {
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "properties": {
            "lastName": {
              "$ref": "#/definitions/string_tag"
            }
          },
          "required": ["lastName"],
          "errorMessage": {
            "required": {
              "lastName": "Не размечена фамилия"
            }
          }
        }
      ]
    },
    "currency_value": {
      "description": "see ContractPrice class",
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "properties": {
            "amount": {
              "$ref": "#/definitions/numeric_tag"
            },
            "currency": {
              "$ref": "#/definitions/currency"
            },
            "sign": {
              "$ref": "#/definitions/sign"
            },
            "vat": {
              "description": "НДС",
              "$ref": "#/definitions/numeric_tag"
            },
            "vat_unit": {
              "description": "числовое значение или процент",
              "$ref": "#/definitions/currency"
            },
            "amount_brutto": {
              "description": "= amount_netto + VAT",
              "$ref": "#/definitions/numeric_tag"
            },
            "amount_netto": {
              "description": "amount_brutto minus VAT",
              "$ref": "#/definitions/numeric_tag"
            }
          },
          "required": []
        }
      ]
    },
    "subject": {
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "properties": {
            "value": {
              "enum": [
                "Other",
                "Charity",
                "RealEstate",
                "Loans",
                "Lawsuit",
                "Insurance",
                "Consulting",
                "RentingOut",
                "Renting",
                "BigDeal",
                "Deal",
                "AgencyContract",
                "BankGuarantees",
                "RelatedTransactions",
                "GeneralContract",
                "EmployeeContracts",
                "PledgeEncumbrance",
                "Liquidation",
                "Service",
                "CashPayments",
                "RefusalToLeaseLand",
                "DealGeneralBusiness",
                "RevisionCommission",
                "Reorganization",
                "InterestedPartyTransaction",
                "RelatedPartyTransaction",
                "AssetTransactions",
                "DealIntellectualProperty",
                "RealEstateTransactions",
                "SecuritiesTransactions",
                "RegisteredCapital",
                "ParticipationInOtherOrganizations",
                "DecisionsForSubsidiary"
              ]
            },
            "insideInformation": {
              "$ref": "#/definitions/insideInformation"
            }
          }
        }
      ]
    },
    "competence": {
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "properties": {
            "value": {
              "enum": [
                "Other",
                "Charity",
                "RealEstate",
                "Loans",
                "Lawsuit",
                "Insurance",
                "Consulting",
                "RentingOut",
                "Renting",
                "BigDeal",
                "Deal",
                "AgencyContract",
                "BankGuarantees",
                "RelatedTransactions",
                "GeneralContract",
                "EmployeeContracts",
                "PledgeEncumbrance",
                "Liquidation",
                "Service",
                "CashPayments",
                "RefusalToLeaseLand",
                "DealGeneralBusiness",
                "RevisionCommission",
                "Reorganization",
                "InterestedPartyTransaction",
                "RelatedPartyTransaction",
                "AssetTransactions",
                "DealIntellectualProperty",
                "RealEstateTransactions",
                "SecuritiesTransactions",
                "RegisteredCapital",
                "ParticipationInOtherOrganizations",
                "DecisionsForSubsidiary"
              ]
            },
            "constraints": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/currency_value"
              }
            }
          }
        }
      ]
    },
    "structural_level": {
      "allOf": [
        {
          "$ref": "#/definitions/tag"
        },
        {
          "properties": {
            "value": {
              "enum": [
                "AllMembers",
                "ShareholdersGeneralMeeting",
                "BoardOfDirectors",
                "CEO",
                "BoardOfCompany"
              ]
            },
            "competences": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/competence"
              }
            }
          }
        }
      ]
    },
    "org": {
      "type": "object",
      "properties": {
        "name": {
          "$ref": "#/definitions/string_tag"
        },
        "type": {
          "$ref": "#/definitions/string_tag"
        },
        "alt_name": {
          "$ref": "#/definitions/string_tag"
        }
      }
    },
    "contract_agent": {
      "allOf": [
        {
          "$ref": "#/definitions/org"
        },
        {
          "properties": {
            "alias": {
              "$ref": "#/definitions/string_tag"
            }
          }
        }
      ]
    }
  },
  "properties": {
    "charter": {
      "properties": {
        "date": {
          "$ref": "#/definitions/date_tag"
        },
        "orgs": {
          "type": "array",
          "maxItems": 1,
          "uniqueItems": true,
          "items": {
            "$ref": "#/definitions/org"
          }
        },
        "structural_levels": {
          "type": "array",
          "uniqueItems": true,
          "items": {
            "$ref": "#/definitions/structural_level"
          }
        }
      }
    },
    "contract": {
      "properties": {
        "subject": {
          "$ref": "#/definitions/subject"
        },
        "date": {
          "$ref": "#/definitions/date_tag"
        },
        "number": {
          "$ref": "#/definitions/string_tag"
        },
        "price": {
          "$ref": "#/definitions/currency_value"
        },
        "insideInformation": {
          "$ref": "#/definitions/insideInformation"
        },
        "people": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/person"
          }
        },
        "orgs": {
          "type": "array",
          "maxItems": 10,
          "uniqueItems": true,
          "items": {
            "$ref": "#/definitions/contract_agent"
          }
        }
      }
    },
    "protocol": {
      "properties": {
        "date": {
          "$ref": "#/definitions/date_tag"
        },
        "number": {
          "$ref": "#/definitions/string_tag"
        },
        "structural_level": {
          "$ref": "#/definitions/structural_level"
        },
        "orgs": {
          "type": "array",
          "maxItems": 1,
          "items": {
            "$ref": "#/definitions/org"
          }
        },
        "agenda_items": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/agenda"
          }
        }
      },
      "additionalProperties": false
    }
  }
}

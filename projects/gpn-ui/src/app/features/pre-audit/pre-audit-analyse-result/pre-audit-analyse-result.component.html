<div style="position: fixed; z-index: 10; width: 100%" >
  <mat-toolbar *ngIf="this.audit">

    <span class="fill-remaining-space"></span>
    <span class="headline-status"><span [class]="audit.status">{{ audit.status | translate}}</span></span>
  </mat-toolbar>

  <mat-tab-group color="accent" (selectedTabChange)="changePage($event)" [(selectedIndex)]="selectedPage">
    <mat-tab label="Документы" [disabled]="maxPageIndex < 1"></mat-tab>
    <mat-tab label="Анализ" [disabled]="maxPageIndex < 2"></mat-tab>
    <mat-tab label="Нарушения" [disabled]="maxPageIndex < 3"></mat-tab>

  </mat-tab-group>

</div>

<div style="margin-top: 110px">

  <div *ngIf="selectedPage == 0">
    <mat-tree *ngIf="!loading" [dataSource]="dataSource" [treeControl]="treeControl">

      <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding>
        <div style="width: 100%">
          <div class="row">
            <div class="col">
              {{ node.name }}
            </div>
            <div class="col col-lg-2"> {{ node.documentNumber? '№' + node.documentNumber : '' }} </div>
            <div class="col col-lg-3"> {{ node.documentDate | date:'d MMMM yyyy'}} </div>
          </div>
          <mat-divider></mat-divider>
        </div>
      </mat-tree-node>

      <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding>
        <div style="width: 100%">
          <div class="row">
            <div class="col">
              <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.name">
                <fa-icon [icon]="faChevronDown" *ngIf="!treeControl.isExpanded(node)"></fa-icon>
                <fa-icon [icon]="faChevronUp" *ngIf="treeControl.isExpanded(node)"></fa-icon>
              </button>
              <span [ngStyle]="{'color': node.name === 'UNKNOWN' ? 'red' : 'black'}">
                {{ node.name | translate }} {{ '(' + node.childCount + ')' }}
              </span>
              <button mat-icon-button *ngIf="node.level === 1" matTooltip="Просмотр" (click)="openEditor(node)">
                <fa-icon [icon]="faEye"></fa-icon>
              </button>
            </div>
          </div>
          <mat-divider></mat-divider>
        </div>
      </mat-tree-node>
    </mat-tree>
  </div>

  <div *ngIf="selectedPage === 1">
    <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">

      <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding>
        <gpn-pre-audit-detail
          [documents]="node"
          [subsidiaryName]="audit.subsidiaryName"
          style="width: 100%"></gpn-pre-audit-detail>
      </mat-tree-node>

      <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding>
        <div style="width: 100%">
          <div class="row">
            <div class="col">
              <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.name">
                <fa-icon [icon]="faChevronDown" *ngIf="!treeControl.isExpanded(node)"></fa-icon>
                <fa-icon [icon]="faChevronUp" *ngIf="treeControl.isExpanded(node)"></fa-icon>
              </button>
              {{ node.name | translate }} {{ '(' + node.childCount + ')' }}
            </div>
          </div>
          <mat-divider></mat-divider>
        </div>
      </mat-tree-node>

    </mat-tree>
  </div>

  <div *ngIf="selectedPage === 2">
    <gpn-violations-pre-audit [idAudit]="IdAudit"></gpn-violations-pre-audit>
  </div>
</div>

<table mat-table [dataSource]="dataSource">

  <!-- Предмет договора -->
  <ng-container matColumnDef="subject">
    <th mat-header-cell *matHeaderCellDef >Предмет договора</th>
    <td mat-cell *matCellDef="let row">
      {{(row?.attributes_tree.contract?.subject?.value | translate) || '⚠️ не обнаружен'}}
    </td>
  </ng-container>

  <!-- Подписант в лице -->
  <ng-container matColumnDef="people">
    <th mat-header-cell *matHeaderCellDef >Подписант в лице</th>
    <td mat-cell *matCellDef="let row">
      <ng-container *ngFor="let person of row?.attributes_tree?.contract?.people">
        {{person.value}}<br>
      </ng-container>
    </td>
  </ng-container>

  <!-- Сумма с НДС -->
  <ng-container matColumnDef="amount_brutto">
    <th mat-header-cell *matHeaderCellDef >Сумма с НДС</th>
    <td mat-cell *matCellDef="let row">
      {{
      (row.attributes_tree?.contract?.price?.amount_brutto?.value |
        currency:row.attributes_tree?.contract?.price?.currency?.value) ||
      (row.attributes_tree?.contract?.subject?.price?.amount_brutto?.value |
        currency:row.attributes_tree?.contract?.subject?.price?.currency?.value)
      || '⚠️ не обнаружена'
      }}
    </td>
  </ng-container>

  <!-- Сумма без НДС -->
  <ng-container matColumnDef="amount_netto">
    <th mat-header-cell *matHeaderCellDef >Сумма без НДС</th>
    <td mat-cell *matCellDef="let row">
      {{
      (row.attributes_tree?.contract?.price?.amount_netto?.value |
        currency:row.attributes_tree?.contract?.price?.currency?.value || ' ') ||
      (row.attributes_tree?.contract?.subject?.price?.amount_netto?.value |
        currency:row.attributes_tree?.contract?.subject?.price?.currency?.value || ' ')
      || '⚠️ не обнаружена'
      }}
    </td>
  </ng-container>

  <!-- инсайд -->
  <ng-container matColumnDef="insider_information">
    <th mat-header-cell *matHeaderCellDef >Инсайд</th>
    <td mat-cell *matCellDef="let row">
      {{(row?.attributes_tree.contract?.insideInformation?.value | translate)
    || (row?.attributes_tree.contract?.subject?.insideInformation?.value | translate)
    || 'Нет'}}
    </td>
  </ng-container>

  <!-- Имя файла -->
  <ng-container matColumnDef="fileName">
    <th mat-header-cell *matHeaderCellDef >Имя файла</th>
    <td mat-cell *matCellDef="let row">
      {{row?.filename}}
    </td>
  </ng-container>


  <!-- контрагент 2 -->
  <ng-container matColumnDef="org2">
    <th mat-header-cell *matHeaderCellDef >контрагент</th>
    <td mat-cell *matCellDef="let row">
      <span class="org-type">{{ row?.attributes_tree?.contract?.orgs[1]?.type?.value}}</span>
      <span class="org-name">{{ row?.attributes_tree.contract?.orgs[1]?.name?.value || '⚠️ не обнаружен'}}</span>
      <span class="org-alias">{{row?.attributes_tree.contract?.orgs[1]?.alias?.value }}</span>
    </td>
  </ng-container>

  <!-- Статус документа -->
  <ng-container matColumnDef="analyze_state">
    <th mat-header-cell *matHeaderCellDef >статус</th>
    <td mat-cell *matCellDef="let doc">
      <gpn-doc-state [document]='doc'></gpn-doc-state>
    </td>
  </ng-container>

  <ng-container matColumnDef="warnings">
    <th mat-header-cell *matHeaderCellDef >!</th>
    <td mat-cell *matCellDef="let doc">
      <span *ngIf="documentTypeName!== 'ANNEX' && hasWarnings(doc)">⚠️</span>
    </td>
  </ng-container>


  <tr mat-header-row *matHeaderRowDef="col"></tr>

  <tr mat-row *matRowDef="let row; columns: col;" class="element-row" (click)="openDocument(row)" (mouseenter)="focusedDoc(row._id)" (mouseleave)="focusedDoc(null)"></tr>

</table>

<table mat-table [dataSource]="dataSource" matSort multiTemplateDataRows matSortActive="date" matSortDirection="desc">



  <ng-container matColumnDef="expandedDetail">
    <td mat-cell *matCellDef="let row" [attr.colspan]="col.length">
      <div style="margin-left: 200px" *ngIf="row._id === expandedElementId" class="element-detail"
           [@detailExpand]="row._id === expandedElementId ? 'expanded' : 'collapsed'">
        <gpn-child-detail [documentType]=documentType [document]=row></gpn-child-detail>
      </div>
    </td>
  </ng-container>


  <!-- star -->
  <ng-container matColumnDef="star">
    <th mat-header-cell *matHeaderCellDef disableClear></th>
    <td mat-cell *matCellDef="let row">
      <button mat-icon-button (click)="starDoc(row, $event)" class="star" [ngStyle]="{'display': focusedId === row._id || row.starred ? 'inline-block' : 'none'}">
        <mat-icon *ngIf="row.starred">star</mat-icon>
        <mat-icon *ngIf="!row.starred">star_border</mat-icon>
      </button>
    </td>
  </ng-container>

  <!-- шэврон -->
  <ng-container matColumnDef="shevron">
    <th mat-header-cell *matHeaderCellDef disableClear></th>
    <td mat-cell *matCellDef="let row">
      <button mat-icon-button (click)="selectedRow(row, $event)">
        <fa-icon [icon]="faChevronDown" *ngIf="row._id != expandedElementId"></fa-icon>
        <fa-icon [icon]="faChevronUp" *ngIf="row._id == expandedElementId"></fa-icon>
      </button>
    </td>
  </ng-container>


  <!-- НОМЕР -->
  <ng-container matColumnDef="inside">
    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>инсайд</th>
    <td mat-cell *matCellDef="let row">
      {{ getAttrValue('inside', row) }}
    </td>
  </ng-container>

  <!-- заинтересованность -->
  <ng-container matColumnDef="interest">
    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>заинтересованность</th>
    <td mat-cell *matCellDef="let row">
      {{ getAttrValue('inside', row) }}
    </td>
  </ng-container>

  <!-- НОМЕР -->
  <ng-container matColumnDef="number">
    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>номер</th>
    <td mat-cell *matCellDef="let row">
      {{ getAttrValue('number', row) }}
    </td>
  </ng-container>

  <!-- Бенефициары -->
  <ng-container matColumnDef="beneficiaries">
    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>бенефициары</th>
    <td mat-cell *matCellDef="let row">
      {{ getAttrValue('beneficiaries', row) }}
    </td>
  </ng-container>

  <!-- ДАТА -->
  <ng-container matColumnDef="date">
    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>дата</th>
    <td mat-cell *matCellDef="let row">
      {{ getAttrValue('date', row) | date}}
    </td>
  </ng-container>


  <!-- контрагент 2 -->
  <ng-container matColumnDef="org2">
    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>контрагент</th>
    <td mat-cell *matCellDef="let row">
      <span class="org-type">{{ getAttrValue('org-2-type', row) }}</span>
      <span class="org-name">{{ getAttrValue('org-2-name', row, '⚠️ не обнаружен') }}</span>
      <span class="org-alias">{{ getAttrValue('org-2-alias', row) }}</span>
    </td>
  </ng-container>

  <ng-container matColumnDef="analyze_state">
    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>статус</th>
    <td mat-cell *matCellDef="let doc">
      <gpn-doc-state [document]='doc'></gpn-doc-state>
    </td>
  </ng-container>


  <ng-container matColumnDef="spacer">
    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear></th>
    <td mat-cell *matCellDef="let doc">
    </td>
  </ng-container>

  <ng-container matColumnDef="warnings">
    <th mat-header-cell *matHeaderCellDef mat-sort-header disableClear>!</th>
    <td mat-cell *matCellDef="let doc">
      <span *ngIf="documentTypeName!== 'ANNEX' && hasWarnings(doc)">⚠️</span>
    </td>
  </ng-container>


  <tr mat-header-row *matHeaderRowDef="col"></tr>

  <tr mat-row *matRowDef="let row; columns: col;" class="element-row" (click)="openDocument(row)" (mouseenter)="focusedDoc(row._id)" (mouseleave)="focusedDoc(null)"></tr>

  <tr mat-row *matRowDef="let row; columns: ['expandedDetail']; when: isExpansionDetailRow" class="detail-row"></tr>

</table>
